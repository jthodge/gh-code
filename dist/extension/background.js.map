{"version":3,"file":"background.js","sourceRoot":"/","sources":["extension/background.ts"],"names":[],"mappings":"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","sourcesContent":["import { Data } from \"../common/interfaces/data.interface\";\n\nconst DEFAULT_DATA = {\n  data: {\n    repos: {}\n  }\n};\n\nlet DATA = DEFAULT_DATA.data as Data;\n\nbrowser.runtime.onMessage.addListener(({ subject }: any) => {\n  if (subject === \"gh-code-open-repo\") {\n    console.log(\"creating context menu\");\n\n    browser.menus.create({\n      id: \"gh-code-open-repo\",\n      contexts: [\"all\"],\n      title: \"Open in Code\",\n      icons: { \"16\": \"../icons/code-logo.png\" },\n      documentUrlPatterns: [`*://*.github.com/*`]\n    });\n  }\n});\n\nbrowser.menus.onClicked.addListener(({ menuItemId }, tab) => {\n  switch (menuItemId) {\n    case \"gh-code-open-repo\": {\n      openRepo(tab);\n    }\n  }\n});\n\nbrowser.browserAction.onClicked.addListener(function(tab) {\n  browser.windows.create({\n    url: browser.runtime.getURL(\"dist/next/out/index.html\"),\n    type: \"popup\",\n    height: 600,\n    width: 1300\n  });\n});\n\nbrowser.storage.onChanged.addListener(loadData);\n\nloadData();\n\nfunction openRepo(tab: browser.tabs.Tab) {\n  const { repos } = DATA;\n  const matches = tab.url.match(/github.com\\/([^/]*\\/[^/]*)/);\n\n  if (matches) {\n    const name = matches[1];\n    const repo = Object.entries(repos)\n      .map(([_key, repo]) => repo)\n      .find(repo => repo.name === name);\n\n    if (repo) {\n      window.location.href = `vscode://file${repo.localPath}`;\n    } else {\n      openPopup({ intent: \"create-repo\", name }, tab);\n    }\n  }\n}\n\nfunction queryString(data: { [key: string]: string }): string {\n  let query = ``;\n\n  Object.entries(data).forEach(([key, value], index) => {\n    const op = index === 0 ? \"?\" : \"&\";\n    query = query.concat(`${op}${key}=${value}`);\n  });\n\n  return query;\n}\n\nfunction openPopup(data: any, tab: browser.tabs.Tab) {\n  const path = browser.extension.getURL(\"next/out/index.html\");\n  const query = queryString(data);\n  const popup = encodeURI(`${path}${query}`);\n\n  browser.browserAction.setPopup({ tabId: tab.id, popup });\n  browser.browserAction.openPopup();\n  browser.browserAction.setPopup({ tabId: tab.id, popup: path });\n}\n\nasync function loadData() {\n  const { data } = ((await browser.storage.local.get(\"data\")) as unknown) as {\n    data: Data;\n  };\n\n  if (!data) {\n    return browser.storage.local.set(DEFAULT_DATA);\n  }\n\n  DATA = data;\n}\n"]}